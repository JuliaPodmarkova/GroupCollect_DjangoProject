{% extends "base.html" %}
{% load static %}

{% block title %}
    {{ collect.title }} - –î–µ—Ç–∞–ª–∏ —Å–±–æ—Ä–∞
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –°—É–º–º–∞ -->
        <div class="col-lg-7">
            <h1 class="mb-3">{{ collect.title }}</h1>

            {% if collect.cover_image %}
                <img src="{{ collect.cover_image.url }}" class="img-fluid rounded shadow-sm mb-4" alt="{{ collect.title }}">
            {% else %}
                <img src="https://placehold.co/800x400/f0fff0/4B0082?text=–°–±–æ—Ä+—Å—Ä–µ–¥—Å—Ç–≤" class="img-fluid rounded shadow-sm mb-4" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–±–æ—Ä–∞">
            {% endif %}

            <div class="progress mb-3" style="height: 30px;">
                <div class="progress-bar bg-success" role="progressbar"
                     style="width: {{ collect.get_raised_percentage }}%;"
                     aria-valuenow="{{ collect.get_raised_percentage }}"
                     aria-valuemin="0"
                     aria-valuemax="100">
                    {{ collect.get_raised_percentage|floatformat:0 }}%
                </div>
            </div>

            <p class="lead">–°–æ–±—Ä–∞–Ω–æ <strong>{{ collect.raised_amount }} ‚ÇΩ</strong> –∏–∑ <strong>{{ collect.goal_amount|default:"–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π —Å—É–º–º—ã" }} ‚ÇΩ</strong></p>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ê–≤—Ç–æ—Ä, –û–ø–∏—Å–∞–Ω–∏–µ –∏ –ö–Ω–æ–ø–∫–∞ –¥–æ–Ω–∞—Ç–∞ -->
        <div class="col-lg-5">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">–ê–≤—Ç–æ—Ä —Å–±–æ—Ä–∞</h5>
                    <div class="d-flex align-items-center mb-3">
                        {% if collect.author.profile.avatar %}
                            <img src="{{ collect.author.profile.avatar.url }}" class="rounded-circle me-3" width="50" height="50" alt="–ê–≤–∞—Ç–∞—Ä">
                        {% else %}
                            <img src="{% static 'img/default_avatar.png' %}" class="rounded-circle me-3" width="50" height="50" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é">
                        {% endif %}
                        <div>
                            <strong>{{ collect.author.get_full_name|default:collect.author.username }}</strong>
                        </div>
                    </div>
                    <hr>
                    <h5 class="card-title">–û–ø–∏—Å–∞–Ω–∏–µ</h5>
                    <p class="card-text">{{ collect.description|linebreaksbr }}</p>

                    {% if collect.is_active %}
                        <div class="d-grid">
                            <a href="{% url 'payment_demo' pk=collect.pk %}" class="btn btn-lg btn-success">‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–±–æ—Ä</a>
                        </div>
                    {% else %}
                        <div class="alert alert-secondary text-center" role="alert">
                            –°–±–æ—Ä –∑–∞–≤–µ—Ä—à—ë–Ω
                        </div>
                    {% endif %}
                </div>
                <div class="card-footer text-muted">
                    –°–±–æ—Ä –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è: {{ collect.end_at|date:"d F Y –≤ H:i" }}
                </div>
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="row mt-5">
        <div class="col-lg-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 class="mb-4">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ collect.comments.count }})</h3>

                    <!-- –ù–ê–ß–ê–õ–û –ò–ó–ú–ï–ù–ï–ù–ò–ô: –§–æ—Ä–º–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                    {% if user.is_authenticated %}
                        <form method="post" class="mb-4">
                            {% csrf_token %}
                            {{ comment_form.as_p }}
                            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                        </form>
                    {% else %}
                        <div class="alert alert-info">
                            <a href="{% url 'login' %}?next={{ request.path }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.
                        </div>
                    {% endif %}
                    <!-- –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–ô -->

                    <hr>

                    {% for comment in comments %}
                        <div class="d-flex mb-3">
                            <div class="flex-shrink-0">
                                {% if comment.author.profile.avatar %}
                                    <img src="{{ comment.author.profile.avatar.url }}" class="rounded-circle" width="50" height="50" alt="–ê–≤–∞—Ç–∞—Ä">
                                {% else %}
                                    <img src="{% static 'img/default_avatar.png' %}" class="rounded-circle" width="50" height="50" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é">
                                {% endif %}
                            </div>
                            <div class="ms-3 flex-grow-1">
                                <div class="fw-bold">{{ comment.author.username }}</div>
                                <p>{{ comment.text|linebreaksbr }}</p>
                                <small class="text-muted">{{ comment.created_at|date:"d F Y –≤ H:i" }}</small>
                            </div>
                        </div>
                    {% empty %}
                        <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}